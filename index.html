<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="css/main.css">

    <title>Hello, world!</title>
</head>
<body>
<!-- <h1>Hello, world!</h1> -->
<nav class="site-header sticky-top py-1">
    <div class="container d-flex flex-column flex-md-row justify-content-between">
        <a class="py-2" href="#">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                 stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                 class="d-block mx-auto">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="14.31" y1="8" x2="20.05" y2="17.94"></line>
                <line x1="9.69" y1="8" x2="21.17" y2="8"></line>
                <line x1="7.38" y1="12" x2="13.12" y2="2.06"></line>
                <line x1="9.69" y1="16" x2="3.95" y2="6.06"></line>
                <line x1="14.31" y1="16" x2="2.83" y2="16"></line>
                <line x1="16.62" y1="12" x2="10.88" y2="21.94"></line>
            </svg>
        </a>
        <a class="py-2 d-none d-md-inline-block" href="#">Tour</a>
        <a class="py-2 d-none d-md-inline-block" href="#">Product</a>
        <a class="py-2 d-none d-md-inline-block" href="#">Features</a>
        <a class="py-2 d-none d-md-inline-block" href="#">Enterprise</a>
        <a class="py-2 d-none d-md-inline-block" href="#">Support</a>
        <a class="py-2 d-none d-md-inline-block" href="#">Pricing</a>
        <a class="py-2 d-none d-md-inline-block" href="#">Cart</a>
    </div>
</nav>

<div class="position-relative overflow-hidden p-3 p-md-5 m-md-3 text-center bg-tertiary">
    <div class="col-md-5 p-lg-5 mx-auto my-5">
        <h1 class="display-4 font-weight-normal">Přepis řeči na text</h1>
        <p class="lead font-weight-normal">Využijte pokročilé umělé inteligence k přepisu textu na řeč z libovolného
            jazyka.</p>
    </div>
    <!--
    <div class="product-device box-shadow d-none d-md-block"></div>
    <div class="product-device product-device-2 box-shadow d-none d-md-block"></div>
    -->
</div>

<div class="position-relative overflow-hidden p-3 p-md-5 m-md-3 text-center bg-light">
    <div>
        <!--<form action="http://localhost:8880/files/" method="post">-->
        <form>
            <!--
            <div class="form-group">
                <label for="exampleInputPassword1">Password</label>
                <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
            </div>
            -->
            <!--
            <div class="form-group">
                <label for="languageSelect">Jazyk nahrávky</label>
                <select class="form-control" id="languageSelect">
                    <option value="cs">Čeština</option>
                    <option value="en">Angličtina</option>
                    <option value="de">Němčina</option>
                    <option value="fr">Francouzština</option>
                    <option value="es">Španělština</option>
                </select>
            </div>
            -->
            <div class="form-group" id="choose-audio">
                <label for="audioFile">Zvolte audio nahrávku (v libovolném jazyce)</label>
                <input type="file" class="form-control-file center" id="audioFile" name="audioFile">
            </div>
            <button id="upload-button" onclick="uploadFile()" class="btn btn-primary">Spustit přepis na text</button>
            <div id="upload-spinner" class="spinner-border text-primary" role="status">
                <span class="sr-only">Prosím čekejte, nahrávka se zpracovává...</span>
            </div>
        </form>
    </div>
</div>


<div class="col-md-5 p-lg-5 mx-auto my-5" id="transcript-short">
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Přepis textu (ukázka prvních 30s)</h5>
            <div class="card-text h-25 overflow-auto" id="transcription">Lorem Ipsum is simply dummy text of the
                printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since
                the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.
                It has survived not only five centuries, but also the leap into electronic typesetting,
            </div>
            <a href="#" class="card-link" id="transcript-download">Stáhnout</a>
            <a href="#" class="card-link" id="transcript-copy">Zkopírovat</a>
        </div>
    </div>
</div>

<div class="form-group" id="full-transcript-form">
    <div class="position-relative overflow-hidden p-3 p-md-5 m-md-3 text-center bg-light">
        <div>
            <!--<form action="http://localhost:8880/files/" method="post">-->
            <form>
                <label for="exampleInputEmail1">Zadejte Vaši emailovou adresu, kam se přepis zašle:</label>
                <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp"
                       placeholder="Enter email">
                <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone
                    else.</small>
                <div class="form-check">
                    <input id="GDPRCheckbox" type="checkbox" class="form-check-input">
                    <label class="form-check-label" for="GDPRCheckbox">Souhlasím se zpracováním osobních údajů pro účely
                        GDPR a zaslání finálního přepisu na zadaný email.</label>
                </div>
                <div class="col-md-5 p-lg-5 mx-auto my-5" id="transcript-full-button-div">
                    <button onclick="payment()" class="btn btn-primary" id="transcript-full-button">Dokončit přepis celého textu [30 Kč]
                    </button>
                </div>
            </form>

        </div>
    </div>
</div>



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <script>
$(document).ready(function() {
   hide_extra();
});

function hide_extra() {
   $('#transcript-short').hide();
   //$('#full-transcript-form').hide();
   $('#transcript-full').hide();
   $('#upload-spinner').hide();
}


function download(filename, text) {
  var element = document.createElement('a');
  element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
  element.setAttribute('download', filename);

  element.style.display = 'none';
  document.body.appendChild(element);

  element.click();

  document.body.removeChild(element);
}

async function uploadFile() {
    let formData = new FormData();
    //const lang = $("#languageSelect").find(":selected").val();
    //console.log(lang);
    formData.append("file", audioFile.files[0]);
    //formData.append("language", lang);

    let headers = new Headers();
    headers.append('Content-Type', 'multipart/form-data');
    headers.append('Accept', 'application/json');

    //headers.append('Authorization', 'Basic ' + base64.encode(username + ":" +  password));
    headers.append('Origin','http://localhost:8880');
    //headers.append('Access-Control-Allow-Origin', '*');

    $('#upload-spinner').show();
    $('#upload-button').hide();

    var res = await fetch('http://localhost:8880/uploadfile', {
        //mode: 'no-cors',
        //credentials: 'include',
        method: 'POST',
        //headers: headers,
        body: formData
    });
    $('#upload-spinner').hide();

    var json = await res.json();
    var fileId = json['id'];
    var text = json['text'];
    var totalSeconds = json['total_seconds'];
    var totalPrice = json['total_price'];
    window.localStorage.setItem('fileId', fileId);

    $("#transcription").text(json.text);
    $("#transcript-download").click(function() {
        const text = $("#transcription").text();
        download('prepis.txt', text);
    });
    $("#transcript-copy").click(function() {
        const text = $("#transcription").text();
        navigator.clipboard.writeText(text);
    });
    $('#transcript-short').show();
    $('#transcript-full').hide();

    if (totalSeconds < 30) {
       $('#full-transcript-form').hide();
    }
    else {
       $('#transcript-full-button').text('Dokončit přepis celého textu [' + totalPrice + ' Kč]');
       $('#full-transcript-form').show();
    }
}

async function payment() {
    let formData = new FormData();
    //const lang = $("#languageSelect").find(":selected").val();
    //console.log(lang);
    formData.append("file", audioFile.files[0]);
    //formData.append("language", lang);

    let headers = new Headers();
    headers.append('Content-Type', 'multipart/form-data');
    headers.append('Accept', 'application/json');

    //headers.append('Authorization', 'Basic ' + base64.encode(username + ":" +  password));
    headers.append('Origin','http://localhost:8880');
    //headers.append('Access-Control-Allow-Origin', '*');

    $('#upload-spinner').show();
    $('#upload-button').hide();

    var res = await fetch('http://localhost:8880/uploadfile', {
        //mode: 'no-cors',
        //credentials: 'include',
        method: 'POST',
        //headers: headers,
        body: formData
    });
    $('#upload-spinner').hide();

}


    </script>

</body>
</html>